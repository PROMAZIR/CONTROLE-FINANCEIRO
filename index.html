<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festa da Adriane - Confirmação</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
       /* ===== RESET E BASE ===== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* ===== MODAL ===== */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 20px;
    text-align: center;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.modal-content h2 {
    color: #333;
    margin-bottom: 20px;
    font-size: 24px;
}

.event-info {
    text-align: left;
    margin: 20px 0;
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
}

.event-info p {
    margin: 10px 0;
    color: #555;
    display: flex;
    align-items: center;
    gap: 10px;
}

.event-info i {
    color: #667eea;
    width: 20px;
}

/* ===== TELAS ===== */
.screen {
    width: 100%;
    max-width: 400px;
    height: 600px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    display: none;
}

#welcomeScreen {
    display: flex;
    align-items: center;
    justify-content: center;
}

#chatScreen {
    display: flex;
    flex-direction: column;
}

/* ===== WELCOME SCREEN ===== */
.welcome-content {
    text-align: center;
    padding: 40px;
}

.avatar {
    margin-bottom: 20px;
}

.avatar img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 4px solid #667eea;
}

.welcome-content h1 {
    color: #333;
    margin-bottom: 10px;
    font-size: 28px;
}

.welcome-content p {
    color: #666;
    margin-bottom: 30px;
    font-size: 16px;
}

/* ===== BOTÕES ===== */
.start-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin: 0 auto;
}

.start-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
}

/* ===== CHAT HEADER ===== */
.chat-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.contact-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.avatar-small img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.contact-details h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
}

.status {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    opacity: 0.9;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
}

.status-dot.online {
    background: #4CAF50;
    animation: pulse 2s infinite;
}

.status-dot.away {
    background: #FF9800;
}

.status-dot.typing {
    background: #2196F3;
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* ===== MENSAGENS ===== */
.chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #f8f9fa;
}

.message {
    margin-bottom: 15px;
    display: flex;
}

.message.user {
    justify-content: flex-end;
}

.message.adriane {
    justify-content: flex-start;
}

.message.system {
    justify-content: center;
}

.message-bubble {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 18px;
    position: relative;
    word-wrap: break-word;
}

.message.user .message-bubble {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-bottom-right-radius: 4px;
}

.message.adriane .message-bubble {
    background: white;
    color: #333;
    border: 1px solid #e0e0e0;
    border-bottom-left-radius: 4px;
}

.message.system .message-bubble {
    background: #e3f2fd;
    color: #1976d2;
    text-align: center;
    border-radius: 10px;
    max-width: 90%;
}

.message-time {
    font-size: 11px;
    opacity: 0.7;
    margin-top: 5px;
    text-align: right;
}

.message.adriane .message-time {
    text-align: left;
}

/* ===== INDICADOR DE DIGITAÇÃO ===== */
.typing-indicator {
    padding: 10px 20px;
    display: none;
}

.typing-bubble {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 18px;
    border-bottom-left-radius: 4px;
    padding: 12px 16px;
    max-width: 60px;
}

.typing-dots {
    display: flex;
    gap: 4px;
}

.typing-dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #999;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-dots span:nth-child(1) { animation-delay: -0.32s; }
.typing-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
    0%, 80%, 100% {
        transform: scale(0);
        opacity: 0.5;
    }
    40% {
        transform: scale(1);
        opacity: 1;
    }
}

/* ===== INPUT ===== */
.input-container {
    padding: 15px 20px;
    background: white;
    border-top: 1px solid #e0e0e0;
    display: none;
}

.input-group {
    display: flex;
    gap: 10px;
    align-items: center;
}

#messageInput {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid #ddd;
    border-radius: 25px;
    font-size: 14px;
    outline: none;
    transition: border-color 0.3s ease;
}

#messageInput:focus {
    border-color: #667eea;
}

.send-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.send-btn:hover {
    transform: scale(1.1);
}

/* ===== OPÇÕES ===== */
.options-container {
    padding: 15px 20px;
    background: white;
    border-top: 1px solid #e0e0e0;
    display: none;
}

.option-btn {
    width: 100%;
    padding: 12px 16px;
    margin-bottom: 8px;
    background: white;
    border: 2px solid #667eea;
    border-radius: 25px;
    color: #667eea;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
}

.option-btn:hover {
    background: #667eea;
    color: white;
    transform: translateY(-1px);
}

.option-btn:last-child {
    margin-bottom: 0;
}

/* ===== CONFIRMAÇÃO ===== */
.confirmation-preview .message-bubble {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    max-width: 95%;
    padding: 0;
    border-radius: 15px;
    overflow: hidden;
}

.confirmation-bubble {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.confirmation-header {
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    text-align: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.confirmation-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
}

.confirmation-section {
    padding: 20px;
}

.confirmation-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 15px;
    padding: 12px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.confirmation-item:last-child {
    margin-bottom: 0;
}

.item-icon {
    font-size: 18px;
    min-width: 25px;
    text-align: center;
}

.item-content {
    flex: 1;
}

.item-content strong {
    display: block;
    margin-bottom: 4px;
    font-size: 14px;
    opacity: 0.9;
}

.item-value {
    font-size: 15px;
    font-weight: 500;
}

.item-value.confirmed {
    color: #4CAF50;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.event-details {
    background: rgba(255, 255, 255, 0.1);
    margin: 0 20px 20px 20px;
    padding: 15px;
    border-radius: 10px;
}

.event-details h4 {
    margin: 0 0 10px 0;
    font-size: 16px;
    text-align: center;
}

.event-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.event-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
}

.event-icon {
    font-size: 16px;
    min-width: 20px;
}

.location-details {
    background: rgba(255, 255, 255, 0.1);
    margin: 0 20px 20px 20px;
    padding: 15px;
    border-radius: 10px;
}

.location-details h4 {
    margin: 0 0 10px 0;
    font-size: 16px;
    text-align: center;
}

.location-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.location-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
}

.location-icon {
    font-size: 16px;
    min-width: 20px;
}

.confirmation-footer {
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    text-align: center;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
}

.confirmation-footer p {
    margin: 5px 0;
    font-size: 14px;
}

/* ===== OPÇÕES FINAIS ===== */
.final-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.whatsapp-btn {
    background: linear-gradient(135deg, #25D366, #128C7E) !important;
    color: white !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    gap: 10px;
    text-decoration: none !important;
    transition: all 0.3s ease;
    border: none !important;
}

.whatsapp-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
    background: linear-gradient(135deg, #128C7E, #25D366) !important;
}

.maps-btn {
    background: linear-gradient(135deg, #4285F4, #34A853) !important;
    color: white !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    gap: 10px;
    text-decoration: none !important;
    transition: all 0.3s ease;
    border: none !important;
}

.maps-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(66, 133, 244, 0.4);
    background: linear-gradient(135deg, #34A853, #4285F4) !important;
}

.info-btn {
    background: linear-gradient(135deg, #f093fb, #f5576c) !important;
    color: white !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s ease;
    border: none !important;
}

.info-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(240, 147, 251, 0.4);
    background: linear-gradient(135deg, #f5576c, #f093fb) !important;
}

/* ===== STATUS MESSAGES ===== */
.status-message {
    padding: 15px;
    text-align: center;
    margin: 10px 20px;
    border-radius: 10px;
    font-weight: 500;
    display: none;
}

.status-message.loading {
    background: #e3f2fd;
    color: #1976d2;
    border: 1px solid #bbdefb;
}

.status-message.success {
    background: #e8f5e8;
    color: #2e7d32;
    border: 1px solid #c8e6c9;
}

.status-message.error {
    background: #ffebee;
    color: #c62828;
    border: 1px solid #ffcdd2;
}

.status-message i {
    margin-right: 8px;
}

/* ===== SCROLLBAR ===== */
.chat-messages::-webkit-scrollbar {
    width: 6px;
}

.chat-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.chat-messages::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.chat-messages::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* ===== RESPONSIVO ===== */
@media (max-width: 768px) {
    body {
        padding: 10px;
        align-items: flex-start;
        padding-top: 20px;
    }
    
    .screen {
        max-width: 100%;
        height: calc(100vh - 40px);
        border-radius: 15px;
    }
    
    .modal-content {
        padding: 20px;
        border-radius: 15px;
    }
    
    .modal-content h2 {
        font-size: 20px;
    }
    
    .event-info {
        padding: 15px;
    }
    
    .welcome-content {
        padding: 30px 20px;
    }
    
    .welcome-content h1 {
        font-size: 24px;
    }
    
    .avatar img {
        width: 80px;
        height: 80px;
    }
    
    .chat-header {
        padding: 12px 15px;
    }
    
    .chat-messages {
        padding: 15px;
    }
    
    .message-bubble {
        max-width: 85%;
        padding: 10px 14px;
    }
    
    .confirmation-header {
        padding: 15px;
    }
    
    .confirmation-header h3 {
        font-size: 16px;
    }
    
    .confirmation-section {
        padding: 15px;
    }
    
    .confirmation-item {
        padding: 10px;
        margin-bottom: 12px;
    }
    
    .item-icon {
        font-size: 16px;
        min-width: 20px;
    }
    
    .item-content strong {
        font-size: 13px;
    }
    
    .item-value {
        font-size: 14px;
    }
    
    .event-details,
    .location-details {
        margin: 0 15px 15px 15px;
        padding: 12px;
    }
    
    .confirmation-footer {
        padding: 15px;
    }
    
    .final-options {
        gap: 8px;
    }
    
    .whatsapp-btn span,
    .maps-btn span,
    .info-btn span {
        font-size: 14px;
    }
    
    .input-container {
        padding: 12px 15px;
    }
    
    .options-container {
        padding: 12px 15px;
    }
    
    .option-btn {
        padding: 10px 14px;
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    .screen {
        height: calc(100vh - 20px);
        border-radius: 10px;
    }
    
    .modal-content {
        width: 95%;
        padding: 15px;
    }
    
    .welcome-content {
        padding: 20px 15px;
    }
    
    .welcome-content h1 {
        font-size: 22px;
    }
    
    .start-btn {
        padding: 12px 25px;
        font-size: 14px;
    }
    
    .chat-messages {
        padding: 12px;
    }
    
    .message-bubble {
        max-width: 90%;
        padding: 8px 12px;
        font-size: 14px;
    }
    
    .confirmation-item {
        flex-direction: column;
        gap: 8px;
        text-align: center;
    }
    
    .item-icon {
        font-size: 20px;
    }
    
    .event-item,
    .location-item {
        justify-content: center;
        text-align: center;
    }
}

/* ===== ANIMAÇÕES ===== */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.message.adriane {
    animation: slideIn 0.3s ease-out;
}

.message.user {
    animation: slideInRight 0.3s ease-out;
}

.option-btn {
    animation: fadeIn 0.3s ease-out;
}

.confirmation-preview {
    animation: fadeIn 0.5s ease-out;
}

/* ===== ESTADOS DE HOVER PARA DESKTOP ===== */
@media (hover: hover) {
    .option-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .send-btn:hover {
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .start-btn:hover {
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
}

/* ===== ACESSIBILIDADE ===== */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    .typing-dots span {
        animation: none;
    }
    
    .status-dot.online {
        animation: none;
    }
}

/* ===== MODO ESCURO (OPCIONAL) ===== */
@media (prefers-color-scheme: dark) {
    .modal-content {
        background: #2d2d2d;
        color: white;
    }
    
    .event-info {
        background: #3d3d3d;
    }
    
    .event-info p {
        color: #ccc;
    }
    
    .screen {
        background: #1e1e1e;
    }
    
    .chat-messages {
        background: #2d2d2d;
    }
    
    .message.adriane .message-bubble {
        background: #3d3d3d;
        color: white;
        border-color: #555;
    }
    
    .input-container,
    .options-container {
        background: #2d2d2d;
        border-top-color: #555;
    }
    
    #messageInput {
        background: #3d3d3d;
        color: white;
        border-color: #555;
    }
    
    #messageInput:focus {
        border-color: #667eea;
    }
}

/* ===== PRINT STYLES ===== */
@media print {
    body {
        background: white;
    }
    
    .screen {
        box-shadow: none;
        border: 1px solid #ccc;
    }
    
    .chat-header {
        background: #f5f5f5 !important;
        color: black !important;
    }
    
    .message.user .message-bubble {
        background: #e3f2fd !important;
        color: black !important;
    }
    
    .confirmation-bubble {
        background: #f5f5f5 !important;
        color: black !important;
    }

    </style>
</head>
<body>
    <!-- Modal de Localização -->
    <div id="locationModal" class="modal">
        <div class="modal-content">
            <h2>🎉 Festa da Adriane</h2>
            <div class="event-info">
                <p><i class="fas fa-calendar"></i> <strong>Data:</strong> 29 de Junho de 2025</p>
                <p><i class="fas fa-clock"></i> <strong>Horário:</strong> 11:00 da manhã</p>
                <p><i class="fas fa-map-marker-alt"></i> <strong>Local:</strong> Casa da Adriane</p>
                <p><i class="fas fa-utensils"></i> <strong>Tipo:</strong> Churrasco de Aniversário</p>
            </div>
            <button id="startChatBtn" class="start-btn">
                <i class="fas fa-comments"></i>
                Confirmar Presença
            </button>
        </div>
    </div>

    <!-- Tela de Boas-vindas -->
    <div id="welcomeScreen" class="screen">
        <div class="welcome-content">
            <div class="avatar">
                <img src="https://media-gru2-2.cdn.whatsapp.net/v/t61.24694-24/491883852_1393418705301138_7718926290771448814_n.jpg?ccb=11-4&oh=01_Q5Aa1wHBUtWW21R9NPnQ0AItU70gdVkD3Z05CENdZY0oNlc6rw&oe=68654350&_nc_sid=5e03e0&_nc_cat=109" alt="Adriane">
            </div>
            <h1>🎂 Festa da Adriane</h1>
            <p>Confirme sua presença no meu aniversário!</p>
            <button id="startChatBtn" class="start-btn">
                <i class="fas fa-comments"></i>
                Começar Conversa
            </button>
        </div>
    </div>

    <!-- Tela do Chat -->
    <div id="chatScreen" class="screen">
        <!-- Header do Chat -->
        <div class="chat-header">
            <div class="contact-info">
                <div class="avatar-small">
                    <img src="https://via.placeholder.com/40x40/ff6b9d/ffffff?text=A" alt="Adriane">
                </div>
                <div class="contact-details">
                    <h3>Adriane</h3>
                    <div id="adrianeStatus" class="status online">
                        <span class="status-dot online"></span> Online
                    </div>
                </div>
            </div>
        </div>

        <!-- Área de Mensagens -->
        <div id="chatMessages" class="chat-messages">
            <!-- Mensagens serão inseridas aqui dinamicamente -->
        </div>

        <!-- Indicador de Digitação -->
        <div id="typingIndicator" class="typing-indicator">
            <div class="typing-bubble">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- Container de Input -->
        <div id="inputContainer" class="input-container">
            <div class="input-group">
                <input type="text" id="messageInput" placeholder="Digite sua mensagem...">
                <button id="sendBtn" class="send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Container de Opções -->
        <div id="optionsContainer" class="options-container">
            <!-- Opções serão inseridas aqui dinamicamente -->
        </div>

        <!-- Estados de Loading/Success/Error -->
        <div id="loading" class="status-message loading">
            <i class="fas fa-spinner fa-spin"></i>
            Processando...
        </div>

        <div id="successMessage" class="status-message success">
            <i class="fas fa-check-circle"></i>
            Confirmação enviada com sucesso!
        </div>

        <div id="errorMessage" class="status-message error">
            <i class="fas fa-exclamation-triangle"></i>
            Erro ao processar. Tente novamente.
        </div>
    </div>
</body>
</html>
    <script>
      // ===== VARIÁVEIS GLOBAIS =====
var currentStep = 0;
var userResponses = {};
var activityMonitor = null;

// ===== CONFIGURAÇÃO DOS PASSOS =====
var chatSteps = [
    {
        message: "Oi! Que bom te ver aqui! 😊\n\nEu sou a Adriane e estou super animada com minha festa de aniversário!\n\nVamos confirmar sua presença?",
        type: "options",
        options: [
            { text: "Sim, vamos lá! 🎉", value: "sim" },
            { text: "Talvez outra hora", value: "nao" }
        ],
        field: "attendance"
    },
    {
        message: "Que maravilha! 🥳\n\nPrimeiro, me conta seu nome para eu te conhecer melhor:",
        type: "input",
        field: "name"
    },
    {
        message: "Prazer em te conhecer, {name}! 😄\n\nAgora vamos organizar as bebidas da festa. Você pode contribuir com:",
        type: "options",
        options: [
            { text: "2 Litros de refrigerante 🥤", value: "2l_refri" },
            { text: "1 Caixa de cerveja (12 unidades) 🍺", value: "1cx_cerveja" },
            { text: "Água e sucos naturais 💧", value: "agua_sucos" },
            { text: "Não posso contribuir com bebidas", value: "nao_bebida" }
        ],
        field: "drinkQuantity"
    },
    {
        message: "Perfeito! E para o churrasco, que tal contribuir com:",
        type: "options",
        options: [
            { text: "1kg de carne (bovina) 🥩", value: "1kg_bovina" },
            { text: "1kg de frango 🍗", value: "1kg_frango" },
            { text: "Linguiça e bacon 🥓", value: "linguica_bacon" },
            { text: "Não posso contribuir com carne", value: "nao_carne" }
        ],
        field: "meatQuantity"
    },
    {
        message: "Quase terminando! 😊\n\nTem alguma observação especial? (alergias, restrições alimentares, etc.)\n\nSe não tiver, pode escrever 'não':",
        type: "input",
        field: "additionalInfo"
    }
];

// ===== FORMATAÇÃO DE RESPOSTAS =====
var responseFormats = {
    drinkQuantity: {
        "2l_refri": "2 Litros de refrigerante 🥤",
        "1cx_cerveja": "1 Caixa de cerveja (12 unidades) 🍺", 
        "agua_sucos": "Água e sucos naturais 💧",
        "nao_bebida": "Não irá contribuir com bebidas"
    },
    meatQuantity: {
        "1kg_bovina": "1kg de carne bovina 🥩",
        "1kg_frango": "1kg de frango 🍗",
        "linguica_bacon": "Linguiça e bacon 🥓", 
        "nao_carne": "Não irá contribuir com carne"
    }
};

// ===== MONITOR DE ATIVIDADE =====
function ActivityMonitor() {
    this.isActive = true;
    this.lastActivity = Date.now();
    this.inactivityTimeout = 30000; // 30 segundos
    this.checkInterval = 5000; // 5 segundos
    this.intervalId = null;
    
    this.init();
}

ActivityMonitor.prototype.init = function() {
    var self = this;
    
    // Eventos de atividade
    var events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
    
    events.forEach(function(event) {
        document.addEventListener(event, function() {
            self.updateActivity();
        }, true);
    });
    
    // Verificar periodicamente
    this.intervalId = setInterval(function() {
        self.checkActivity();
    }, this.checkInterval);
    
    this.updateStatus();
};

ActivityMonitor.prototype.updateActivity = function() {
    this.lastActivity = Date.now();
    if (!this.isActive) {
        this.isActive = true;
        this.updateStatus();
    }
};

ActivityMonitor.prototype.checkActivity = function() {
    var now = Date.now();
    var timeSinceLastActivity = now - this.lastActivity;
    
    if (timeSinceLastActivity > this.inactivityTimeout && this.isActive) {
        this.isActive = false;
        this.updateStatus();
    }
};

ActivityMonitor.prototype.updateStatus = function() {
    var statusElement = document.getElementById('adrianeStatus');
    if (statusElement) {
        if (this.isActive) {
            statusElement.innerHTML = '<span class="status-dot online"></span> Online';
            statusElement.className = 'status online';
        } else {
            statusElement.innerHTML = '<span class="status-dot away"></span> Ausente';
            statusElement.className = 'status away';
        }
    }
};

ActivityMonitor.prototype.forceOnline = function() {
    this.updateActivity();
};

ActivityMonitor.prototype.destroy = function() {
    if (this.intervalId) {
        clearInterval(this.intervalId);
    }
};

// ===== FUNÇÕES PRINCIPAIS =====
function startChat() {
    var welcomeScreen = document.getElementById('welcomeScreen');
    var chatScreen = document.getElementById('chatScreen');
    
    if (welcomeScreen) welcomeScreen.style.display = 'none';
    if (chatScreen) chatScreen.style.display = 'flex';
    
    // Inicializar monitor se não existir
    if (!activityMonitor) {
        activityMonitor = new ActivityMonitor();
    }
    
    // Começar conversa
    setTimeout(function() {
        processStep();
    }, 1000);
}

function processStep() {
    if (currentStep >= chatSteps.length) {
        showFinalMessage();
        return;
    }
    
    var step = chatSteps[currentStep];
    var message = step.message;
    
    // Substituir placeholders
    if (userResponses.name) {
        message = message.replace('{name}', userResponses.name);
    }
    
    showTypingIndicator();
    
    setTimeout(function() {
        hideTypingIndicator();
        addMessage(message, 'adriane');
        
        setTimeout(function() {
            if (step.type === 'input') {
                showInput();
            } else if (step.type === 'options') {
                showOptions(step.options);
            }
        }, 500);
    }, 1500);
}

function sendMessage() {
    var messageInput = document.getElementById('messageInput');
    if (!messageInput) return;
    
    var message = messageInput.value.trim();
    if (!message) return;
    
    // Forçar status online
    if (activityMonitor) {
        activityMonitor.forceOnline();
    }
    
    addMessage(message, 'user');
    messageInput.value = '';
    
    // Salvar resposta
    var currentField = chatSteps[currentStep].field;
    userResponses[currentField] = message;
    
    hideAllContainers();
    currentStep++;
    
    setTimeout(function() {
        processStep();
    }, 1000);
}

function selectOption(value, text) {
    // Forçar status online
    if (activityMonitor) {
        activityMonitor.forceOnline();
    }
    
    addMessage(text, 'user');
    
    // Salvar resposta
    var currentField = chatSteps[currentStep].field;
    userResponses[currentField] = value;
    
    // Verificar se escolheu "não" na primeira pergunta
    if (currentField === 'attendance' && value === 'nao') {
        hideAllContainers();
        setTimeout(function() {
            addMessage("Tudo bem! Fica para a próxima então! 😊\n\nSe mudar de ideia, é só voltar aqui. A festa vai ser incrível! 🎉", 'adriane');
        }, 1500);
        return;
    }
    
    hideAllContainers();
    currentStep++;
    
    setTimeout(function() {
        processStep();
    }, 1000);
}

function formatResponse(field, value) {
    if (responseFormats[field] && responseFormats[field][value]) {
        return responseFormats[field][value];
    }
    return value;
}

function showStatusMessageInChat(type, message) {
    var messagesContainer = document.getElementById('chatMessages');
    if (!messagesContainer) return;

    var statusDiv = document.createElement('div');
    statusDiv.className = 'message system';

    var iconClass = '';
    var bgColor = '';

    if (type === 'loading') {
        iconClass = 'fas fa-spinner fa-spin';
        bgColor = '#f8f9fa';
        message = 'Enviando confirmação...';
    } else if (type === 'success') {
        iconClass = 'fas fa-check-circle';
        bgColor = '#d4edda';
        message = 'Confirmação enviada com sucesso!';
    } else if (type === 'error') {
        iconClass = 'fas fa-exclamation-triangle';
        bgColor = '#f8d7da';
        message = 'Erro ao enviar confirmação. Tente novamente.';
    }

    statusDiv.innerHTML = '<div class="message-bubble" style="background: ' + bgColor + '; text-align: center; color: #333; font-weight: 500;">' +
         '<i class="' + iconClass + '"></i> ' + message +
         '</div>';

    messagesContainer.appendChild(statusDiv);
    scrollToBottom();

    return statusDiv;
}

function hideAllContainers() {
    var containers = ['inputContainer', 'optionsContainer', 'loading', 'successMessage', 'errorMessage'];
    for (var i = 0; i < containers.length; i++) {
        var element = document.getElementById(containers[i]);
        if (element) {
            element.style.display = 'none';
        }
    }
}

function showTypingIndicator() {
    var indicator = document.getElementById('typingIndicator');
    if (indicator) {
        indicator.style.display = 'flex';
        scrollToBottom();
    }
    
    // Atualizar status para "digitando"
    var statusElement = document.getElementById('adrianeStatus');
    if (statusElement) {
        statusElement.innerHTML = '<span class="status-dot typing"></span> Digitando...';
        statusElement.className = 'status typing';
    }
}

function hideTypingIndicator() {
    var indicator = document.getElementById('typingIndicator');
    if (indicator) {
        indicator.style.display = 'none';
    }
    
    // Voltar status para online
    if (activityMonitor) {
        activityMonitor.updateStatus();
    }
}

function addMessage(text, sender) {
    var messagesContainer = document.getElementById('chatMessages');
    if (!messagesContainer) return;

    var messageDiv = document.createElement('div');
    messageDiv.className = 'message ' + sender;

    var now = new Date();
    var hours = now.getHours().toString();
    var minutes = now.getMinutes().toString();
    if (hours.length === 1) hours = '0' + hours;
    if (minutes.length === 1) minutes = '0' + minutes;
    var time = hours + ':' + minutes;

    messageDiv.innerHTML = '<div class="message-bubble">' +
         text.replace(/\n/g, '<br>') +
         '<div class="message-time">' + time + '</div>' +
        '</div>';

    messagesContainer.appendChild(messageDiv);
    scrollToBottom();
}

function showInput() {
    hideAllContainers();
    var inputContainer = document.getElementById('inputContainer');
    if (inputContainer) {
        inputContainer.style.display = 'block';
        var messageInput = document.getElementById('messageInput');
        if (messageInput) {
            messageInput.focus();
        }
    }
}

function showOptions(options) {
    hideAllContainers();
    var optionsContainer = document.getElementById('optionsContainer');
    if (!optionsContainer) return;

    optionsContainer.style.display = 'block';
    optionsContainer.innerHTML = '';

    for (var i = 0; i < options.length; i++) {
        var option = options[i];
        var button = document.createElement('button');
        button.className = 'option-btn';
        button.textContent = option.text;
        button.setAttribute('data-value', option.value);
        button.setAttribute('data-text', option.text);
        button.onclick = function() {
            selectOption(this.getAttribute('data-value'), this.getAttribute('data-text'));
        };
        optionsContainer.appendChild(button);
    }
}

function showConfirmationPreview() {
    var messagesContainer = document.getElementById('chatMessages');
    if (!messagesContainer) return;

    var previewDiv = document.createElement('div');
    previewDiv.className = 'message adriane confirmation-preview';
    
    var previewContent = '<div class="message-bubble confirmation-bubble">' +
        '<div class="confirmation-header">' +
            '<h3>🎂 Resumo da sua Confirmação 🎂</h3>' +
        '</div>' +
        
        '<div class="confirmation-section">' +
            '<div class="confirmation-item">' +
                '<span class="item-icon">👤</span>' +
                '<div class="item-content">' +
                    '<strong>Nome:</strong><br>' +
                    '<span class="item-value">' + userResponses.name + '</span>' +
                '</div>' +
            '</div>' +
            
            '<div class="confirmation-item">' +
                '<span class="item-icon">✅</span>' +
                '<div class="item-content">' +
                    '<strong>Presença:</strong><br>' +
                    '<span class="item-value confirmed">CONFIRMADA</span>' +
                '</div>' +
            '</div>' +
            
            '<div class="confirmation-item">' +
                '<span class="item-icon">🍻</span>' +
                '<div class="item-content">' +
                    '<strong>Bebidas:</strong><br>' +
                    '<span class="item-value">' + formatResponse('drinkQuantity', userResponses.drinkQuantity) + '</span>' +
                '</div>' +
            '</div>' +
            
            '<div class="confirmation-item">' +
                '<span class="item-icon">🥩</span>'
                '<div class="item-content">' +
                    '<strong>Churrasco:</strong><br>' +
                    '<span class="item-value">' + formatResponse('meatQuantity', userResponses.meatQuantity) + '</span>' +
                '</div>' +
            '</div>';
            
    if (userResponses.additionalInfo && userResponses.additionalInfo.toLowerCase() !== 'não') {
        previewContent += '<div class="confirmation-item">' +
                '<span class="item-icon">📝</span>' +
                '<div class="item-content">' +
                    '<strong>Observações:</strong><br>' +
                    '<span class="item-value">' + userResponses.additionalInfo + '</span>' +
                '</div>' +
            '</div>';
    }
    
    previewContent += '</div>' +
        
        '<div class="event-details">' +
            '<h4>📅 Detalhes do Evento</h4>' +
            '<div class="event-info">' +
                '<div class="event-item">' +
                    '<span class="event-icon">📆</span>' +
                    '<span>29 de Junho de 2025</span>' +
                '</div>' +
                '<div class="event-item">' +
                    '<span class="event-icon">🕐</span>' +
                    '<span>11:00 da manhã</span>' +
                '</div>' +
                '<div class="event-item">' +
                    '<span class="event-icon">📍</span>' +
                    '<span>Casa da Adriane</span>' +
                '</div>' +
            '</div>' +
        '</div>' +
        
        '<div class="location-details">' +
            '<h4>🗺️ Localização</h4>' +
            '<div class="location-info">' +
                '<div class="location-item">' +
                    '<span class="location-icon">📌</span>' +
                    '<span>Rua das Flores, 123</span>' +
                '</div>' +
                '<div class="location-item">' +
                    '<span class="location-icon">🏘️</span>' +
                    '<span>Jardim Primavera</span>' +
                '</div>' +
                '<div class="location-item">' +
                    '<span class="location-icon">🏙️</span>' +
                    '<span>Goiânia - GO</span>' +
                '</div>' +
            '</div>' +
        '</div>' +
        
        '<div class="confirmation-footer">' +
            '<p>💕 Muito obrigada pela confirmação!</p>' +
            '<p>🎉 Vai ser uma festa incrível!</p>' +
        '</div>' +
        
        '<div class="message-time">' + new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'}) + '</div>' +
    '</div>';
    
    previewDiv.innerHTML = previewContent;
    messagesContainer.appendChild(previewDiv);
    scrollToBottom();
}

function formatConfirmationMessage() {
    var message = '🎂✨ *CONFIRMAÇÃO DE PRESENÇA* ✨🎂\n';
    message += '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n';
    
    message += '🎉 *FESTA DE ANIVERSÁRIO DA ADRIANE* 🎉\n\n';
    
    message += '👤 *DADOS DO CONVIDADO:*\n';
    message += '┌─────────────────────────────────\n';
    message += '│ 📛 Nome: *' + userResponses.name + '*\n';
    message += '│ ✅ Status: *PRESENÇA CONFIRMADA*\n';
    message += '└─────────────────────────────────\n\n';
    
    message += '🍻 *CONTRIBUIÇÃO - BEBIDAS:*\n';
    message += '┌─────────────────────────────────\n';
    message += '│ 🥤 ' + formatResponse('drinkQuantity', userResponses.drinkQuantity) + '\n';
    message += '└─────────────────────────────────\n\n';
    
    message += '🥩 *CONTRIBUIÇÃO - CHURRASCO:*\n';
    message += '┌─────────────────────────────────\n';
    message += '│ 🍖 ' + formatResponse('meatQuantity', userResponses.meatQuantity) + '\n';
    message += '└─────────────────────────────────\n\n';
    
    if (userResponses.additionalInfo && userResponses.additionalInfo.toLowerCase() !== 'não') {
        message += '📝 *OBSERVAÇÕES ESPECIAIS:*\n';
        message += '┌─────────────────────────────────\n';
        message += '│ 💬 ' + userResponses.additionalInfo + '\n';
        message += '└─────────────────────────────────\n\n';
    }
    
    message += '📅 *INFORMAÇÕES DO EVENTO:*\n';
    message += '┌─────────────────────────────────\n';
    message += '│ 📆 Data: *29 de Junho de 2025*\n';
    message += '│ 🕐 Horário: *11:00 da manhã*\n';
    message += '│ 📍 Local: *Casa da Adriane*\n';
    message += '│ 🎪 Tipo: *Churrasco de Aniversário*\n';
    message += '└─────────────────────────────────\n\n';
    
    message += '🗺️ *LOCALIZAÇÃO:*\n';
    message += '┌─────────────────────────────────\n';
    message += '│ 📌 Endereço: *Rua das Flores, 123*\n';
    message += '│ 🏘️ Bairro: *Jardim Primavera*\n';
    message += '│ 🏙️ Cidade: *Goiânia - GO*\n';
    message += '│ 🗺️ Google Maps: https://maps.google.com/?q=-16.6869,-49.2648\n';
    message += '└─────────────────────────────────\n\n';
    
    message += '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n';
    message += '💕 *Confirmação enviada pelo site oficial*\n';
    message += '🎈 *Mal posso esperar para te ver lá!* 🎈\n';
    message += '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━';
    
    return message;
}

function showWhatsAppOption() {
    var confirmation = formatConfirmationMessage();
    var whatsappUrl = 'https://wa.me/5562996373091?text=' + encodeURIComponent(confirmation);
    
    // Coordenadas da festa (substitua pelas coordenadas reais)
    var latitude = -16.6869;
    var longitude = -49.2648;
    var mapsUrl = 'https://www.google.com/maps?q=' + latitude + ',' + longitude;
    
    var optionsContainer = document.getElementById('optionsContainer');
    if (optionsContainer) {
        optionsContainer.style.display = 'block';
        optionsContainer.innerHTML = '<div class="final-options">' +
                '<a href="' + whatsappUrl + '" target="_blank" class="option-btn whatsapp-btn">' +
                    '<i class="fab fa-whatsapp"></i> ' +
                    '<span>Enviar confirmação via WhatsApp</span>' +
                '</a>' +
                
                '<a href="' + mapsUrl + '" target="_blank" class="option-btn maps-btn">' +
                    '<i class="fas fa-map-marker-alt"></i> ' +
                    '<span>Ver localização no Google Maps</span>' +
                '</a>' +
                
                '<button class="option-btn info-btn" onclick="showEventInfo()">' +
                    '<i class="fas fa-info-circle"></i> ' +
                    '<span>Mais informações do evento</span>' +
                '</button>' +
            '</div>';
    }
}

function showEventInfo() {
    var messagesContainer = document.getElementById('chatMessages');
    if (!messagesContainer) return;

    var infoDiv = document.createElement('div');
    infoDiv.className = 'message adriane';
    
    var infoContent = '<div class="message-bubble" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">' +
            '<div style="padding: 20px;">' +
                '<h3 style="margin: 0 0 15px 0; text-align: center;">ℹ️ Informações Importantes</h3>' +
                
                '<div style="margin-bottom: 15px;">' +
                    '<strong>🎯 O que levar:</strong><br>' +
                    '• Sua contribuição confirmada<br>' +
                    '• Roupas confortáveis<br>' +
                    '• Muito bom humor! 😄' +
                '</div>' +
                
                '<div style="margin-bottom: 15px;">' +
                    '<strong>🚗 Estacionamento:</strong><br>' +
                    '• Disponível na rua<br>' +
                    '• Chegue cedo para garantir vaga' +
                '</div>' +
                
                '<div style="margin-bottom: 15px;">' +
                    '<strong>📞 Contato de emergência:</strong><br>' +
                    '• WhatsApp: (62) 99637-3091<br>' +
                    '• Adriane está sempre disponível' +
                '</div>' +
                
                '<div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">' +
                    '<strong>🎉 Mal posso esperar para te ver! 🎉</strong>' +
                '</div>' +
            '</div>' +
            '<div class="message-time">' + new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'}) + '</div>' +
        '</div>';
    
    infoDiv.innerHTML = infoContent;
    messagesContainer.appendChild(infoDiv);
    scrollToBottom();
}

function showFinalMessage() {
    // Mostrar preview bonito da confirmação
    setTimeout(function() {
        showConfirmationPreview();
        
        // Mostrar loading
        setTimeout(function() {
            var loadingMsg = showStatusMessageInChat('loading');
            
            setTimeout(function() {
                // Remover loading
                if (loadingMsg) {
                    loadingMsg.remove();
                }
                
                if (userResponses.attendance === 'sim') {
                    showStatusMessageInChat('success');
                    console.log('Dados da confirmação:', userResponses);
                    
                    setTimeout(function() {
                        showWhatsAppOption();
                    }, 2000);
                }
            }, 2000);
        }, 1000);
    }, 500);
}

function scrollToBottom() {
    var messagesContainer = document.getElementById('chatMessages');
    if (messagesContainer) {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
}

// ===== INICIALIZAÇÃO =====
function initializeApp() {
    console.log('Inicializando aplicação...');

    // Inicializar monitor de atividade
    activityMonitor = new ActivityMonitor();
    console.log('ActivityMonitor inicializado');

    // Configurar event listeners
    var startChatBtn = document.getElementById('startChatBtn');
    if (startChatBtn) {
        startChatBtn.onclick = startChat;
        console.log('Event listener configurado para startChatBtn');
    }

    var sendBtn = document.getElementById('sendBtn');
    if (sendBtn) {
        sendBtn.onclick = sendMessage;
    }

    var messageInput = document.getElementById('messageInput');
    if (messageInput) {
        messageInput.onkeypress = function(e) {
            if (e.key === 'Enter' || e.keyCode === 13) {
                sendMessage();
            }
        };
        
        // Detectar quando usuário está digitando
        messageInput.addEventListener('input', function() {
            if (activityMonitor) {
                activityMonitor.forceOnline();
            }
        });
        
        // Detectar foco no input
        messageInput.addEventListener('focus', function() {
            if (activityMonitor) {
                activityMonitor.forceOnline();
            }
        });
    }

    // Event listeners adicionais para detectar atividade
    document.addEventListener('click', function(e) {
        console.log('Click detectado em:', e.target.tagName);
        if (activityMonitor) {
            activityMonitor.forceOnline();
        }
    });

    // Detectar scroll no chat
    var chatMessages = document.getElementById('chatMessages');
    if (chatMessages) {
        chatMessages.addEventListener('scroll', function() {
            console.log('Scroll detectado no chat');
            if (activityMonitor) {
                activityMonitor.forceOnline();
            }
        });
    }

    // Mostrar modal inicial
    var locationModal = document.getElementById('locationModal');
    if (locationModal) {
        locationModal.style.display = 'flex';
    }

    // Tornar funções globalmente disponíveis
    window.startChat = startChat;
    window.sendMessage = sendMessage;
    window.selectOption = selectOption;
    window.showEventInfo = showEventInfo;
    window.activityMonitor = activityMonitor;

    console.log('Aplicação inicializada com sucesso!');
}

// ===== AGUARDAR DOM PRONTO =====
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeApp);
} else {
    initializeApp();
}

// ===== DEBUG =====
console.log('Script carregado. Funções disponíveis:', {
    startChat: typeof startChat,
    sendMessage: typeof sendMessage,
    initializeApp: typeof initializeApp,
    ActivityMonitor: typeof ActivityMonitor
});


</script>
</body>
</html>
